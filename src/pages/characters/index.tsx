import CardsPiece from "@/global/components/Card";
import React, { Fragment, useEffect, useState } from "react";
import * as M from "@mui/material";
import NavBar from "@/global/components/NavBar";
import { Loading } from "@/global/components/Loading";
import axios from "axios";
import Head from "next/head";
import ModalComponent from "@/global/components/Modal";

export default function Characters() {
  const [data, setData] = useState<any>([]);
  const [resposta, setResposta] = useState<any>([]);
  const [open, setOpen] = React.useState(false);
  const [loading, setLoading] = useState(false);
  const handleOpen = () => setOpen(true);
  const handleClose = () => setOpen(false);
  
  const onePiece = (id: never[]) => {
    const URL = `https://one-piece-br-default-rtdb.firebaseio.com/characters.json`
    axios
      .get(URL + `${id}`)
      .then((response) => {
        setResposta(response.data);
        setOpen(true);
      })
      .catch((err) => console.log(err));
  };

  console.log(resposta,'resposta');
  
const getOnePiece = () => {
  const baseUrl = `https://one-piece-br-default-rtdb.firebaseio.com/characters.json`
  setLoading(true);
  axios.get(baseUrl)
    .then((res) => {
      setData(res.data)
      setLoading(false);
    })
    .catch((err) => console.log(err));
}

useEffect(() => {
  getOnePiece()
}, [])


console.log(data, "data");

const pieceFilter = (name: string) => {
  if (name === "") {
    getOnePiece();
  }
  let filterPiece: any = [];
  for (let i in data) {
    if (data[i].name.includes(name)) {
      filterPiece.push(data[i]);
    }
  }
  setData(filterPiece);
};

return (
    <Fragment>
       <Head>
        <title>One Piece | All Characters</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <NavBar pieceFilter={pieceFilter} value={data} IsSearch />
      {loading ? (
        <Loading />
      ) : (
        <>
          <M.Grid
            container
            spacing={{ xs: 2, md: 3 }}
            columns={{ xs: 4, sm: 8, md: 12 }}
          >
            {data && Object.values(data).map((item: any, index: any) => {
                return (
                  <M.Grid
                    item
                    xs={3}
                    key={index}
                    onClick={() => onePiece(item.name)}
                  >
                    <CardsPiece data={item} action={handleOpen} />
                  </M.Grid>
                );
              })}
          </M.Grid>
        </>
      )}
      {/* {open && (
        <ModalComponent
        open={open}
        onClose={handleClose}
        data={data}
        />
      )} */}
    </Fragment>
  );
}
